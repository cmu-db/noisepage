<project name="test" basedir=".">
<property name="src.dir" value="./src" />
<property name="lib.dir" value="./lib" />
<property name="out.dir" value="./out" />

<target name="compile">
  <mkdir dir="${out.dir}"/>
  <javac srcdir="${src.dir}"
         destdir="${out.dir}"
         includeantruntime="false"
         debug="true" nowarn="on">
    <classpath refid="test.jars"/>
    </javac>
</target>

<target name="clean">
  <delete failonerror="false">
    <fileset dir="${out.dir}" >
      <include name="*.class"/>
    </fileset>
  </delete>
</target>

<path id="test.jars">
  <fileset dir="${lib.dir}">
    <include name="**/*.jar"/>
  </fileset>
</path>

<path id="test.classpath">
  <path refid="test.jars"/>
  <pathelement location="${out.dir}" />
</path>
<!--hide warnings-->
<target name="testconsole" depends="compile">
  <java jar="lib/junit-platform-console-standalone-1.1.0.jar"
        dir="."
        fork="yes"
        failonerror="true">
    <arg value="--class-path" />
    <arg value="${toString:test.classpath}" />
    <arg value="--scan-class-path" />
  </java>
</target>

<target name="test-trace" depends="compile">
  <java jar="lib/junit-platform-console-standalone-1.1.0.jar"
        dir="."
        fork="yes"
        failonerror="false" resultproperty="output">
    <arg value="--class-path" />
    <arg value="${toString:test.classpath}" />
    <arg value="--scan-class-path" />
    <arg value="--include-classname" />
    <arg value="TracefileTest" />
  </java>
  <echo file="src/output.txt">the output is ${output}</echo>
  <junitreport todir="${out.dir}">
    <fileset dir="${out.dir}">
      <include name="TEST-*.xml"/>
    </fileset>
    <report format="frames" todir="${out.dir}"/>
  </junitreport>
</target>
<target name="test-unit" depends="compile">
  <java jar="lib/junit-platform-console-standalone-1.1.0.jar"
        dir="."
        fork="yes"
        failonerror="true">
    <arg value="--class-path" />
    <arg value="${toString:test.classpath}" />
    <arg value="--scan-class-path" />
    <arg value="--exclude-classname" />
    <arg value="TracefileTest" />
  </java>
</target>
<target name="test" depends="compile">
  <junit fork="yes" haltonfailure="false" logfailedtests="true">
    <formatter type="plain" usefile="false" />
    <classpath refid="test.classpath" />
    <batchtest skipNonTests="true">
      <fileset dir="${out.dir}" includes="*.class"/>
    </batchtest>
  </junit>
</target>
</project>

