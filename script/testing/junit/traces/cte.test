query I nosort
WITH cte(x) AS (SELECT 1) SELECT x FROM cte;
----
1 values hashing to b026324c6904b2a9cb4b88d6d61c81d1

query I nosort
WITH cte AS (SELECT 1) SELECT * FROM cte;
----
1 values hashing to b026324c6904b2a9cb4b88d6d61c81d1

query I nosort
WITH cte AS (SELECT 1 AS "x") SELECT * FROM cte;
----
1 values hashing to b026324c6904b2a9cb4b88d6d61c81d1

query I nosort
WITH cte(y) AS (SELECT 1 AS "x") SELECT y FROM cte;
----
1 values hashing to b026324c6904b2a9cb4b88d6d61c81d1

query I nosort
WITH cte(x) AS (WITH cte2(y) AS (SELECT 1) SELECT y FROM cte2) SELECT x FROM cte;
----
1 values hashing to b026324c6904b2a9cb4b88d6d61c81d1

query I nosort
WITH cte(x) AS (SELECT 1), cte2(y) AS (SELECT 2) SELECT cte.x, cte2.y FROM cte INNER JOIN cte2 ON cte.x+1 = cte2.y;
----
2 values hashing to 6ddb4095eb719e2a9f0a3f95677d24e0

statement ok


statement ok
CREATE TABLE tree (node INTEGER, parent INTEGER);

statement ok
INSERT INTO tree VALUES (1,NULL), (10, 1), (11, 1), (100, 10), (101, 10), (110, 11), (111, 11);

query I nosort
WITH RECURSIVE cte(x) AS (SELECT 1 UNION ALL SELECT tree.node FROM tree INNER JOIN cte ON tree.parent=cte.x) SELECT * FROM cte;
----
7 values hashing to e0147388525f89cdac23192c19c5cc75

statement ok


query I nosort
WITH cte(x,x) AS (SELECT 1, 2) SELECT * FROM cte;
----
2 values hashing to 6ddb4095eb719e2a9f0a3f95677d24e0

query I nosort
WITH cte AS (SELECT 4, 3) SELECT * FROM cte;
----
2 values hashing to ba1c8aaf233bb794bc3fc52c7c5c5ac8

query I nosort
WITH cte(y,y,x) AS (SELECT 5,4,3) SELECT x FROM cte;
----
1 values hashing to 6d7fce9fee471194aa8b5b6e47267f03

statement ok


# Porting over junit test cases
statement ok
CREATE TABLE company (id INT PRIMARY KEY NOT NULL, name TEXT NOT NULL, age INT NOT NULL, address CHAR(50), salary REAL);

statement ok
INSERT INTO company (id,name,age,address,salary) VALUES (1, 'Paul', 32, 'California', 20000.00);

statement ok
INSERT INTO company (id,name,age,address,salary) VALUES (2, 'George', 21, 'NY', 10000.00);

statement ok


query I nosort
WITH employee AS (SELECT id, name, age FROM company) SELECT name FROM employee;
----
2 values hashing to be0a0e6a6f990291de5dd0ee0d93b07a

query I nosort
WITH employee AS (SELECT age+age AS sumage, name FROM company) SELECT E2.name, E1.sumage FROM employee AS E1, employee AS E2 WHERE E1.name = E2.name;
----
4 values hashing to 17bcc53db5d5a4ed62836d923837a49e

statement ok


# Aggregate inside cte query
query I nosort
WITH employee AS (SELECT SUM(age) AS sumage FROM company) SELECT * FROM employee;
----
1 values hashing to c92841e00dbfeb12a0ce7fb3ffbd1fcb

# Join inside cte query
query I nosort
WITH employee AS (SELECT C1.name AS name, C2.age AS age FROM company AS C1, company AS C2) SELECT * FROM employee;
----
8 values hashing to c0438f480daa73a1e6dbe888b3600da0

# Aggregate with alias inside cte query
query I nosort
WITH employee AS (SELECT MAX(age) AS mxage FROM company) SELECT E2.name, E2.age FROM employee AS E1, company AS E2 WHERE E1.mxage = E2.age;
----
2 values hashing to 00ea2298aacdab6ef3a930939cd949de

statement ok


statement ok
CREATE TABLE tmp(x INT);

statement ok
INSERT INTO tmp VALUES (1), (2);

# CTE with self-join
query I nosort
WITH cte AS (SELECT * FROM tmp) SELECT A.x, B.x, C.x FROM cte A, cte B, tmp C ORDER BY A.x, B.x, C.x;
----
24 values hashing to 15f5a3ad9d0103293409308a7f45ec34

query I nosort
WITH cte AS (SELECT * FROM tmp) SELECT A.x, B.x, C.x FROM cte A, cte B, cte C ORDER BY A.x, B.x, C.x;
----
24 values hashing to 15f5a3ad9d0103293409308a7f45ec34

